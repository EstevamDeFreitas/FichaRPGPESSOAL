<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Ficha de RPG</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .nivel-box input[type="checkbox"] {
            margin-right: 5px;
        }

        .nivel-box label {
            margin-right: 10px;
        }
    </style>
</head>

<body class="bg-light">

    <div class="container py-4">
        <h1 class="mb-4 text-center">Ficha de Personagem RPG</h1>

        <form id="fichaForm">
            <div class="mb-3">
                <label class="form-label">Nome do Personagem</label>
                <input type="text" class="form-control" id="nome" required>
            </div>

            <div id="grupos"></div>
            <!-- <button type="submit" class="btn btn-primary mt-3">Gerar Ficha</button> -->
        </form>

        <hr class="my-4">
        <div id="resultado" class="mt-4"></div>
    </div>

    <script>
        const grupos = {
            "üí™ Corpo": ["Atletismo", "Briga", "Acrobacia", "Resist√™ncia"],
            "üß† Mente": ["Investiga√ß√£o", "Conhecimento Geral", "Conhecimento Espec√≠fico", "Intui√ß√£o"],
            "üó£Ô∏è Social": ["L√°bia", "Intimida√ß√£o", "Interpreta√ß√£o", "Lideran√ßa"],
            "üõ†Ô∏è T√©cnica": ["Mira/Precis√£o", "Medicina/Of√≠cios", "Magia/Manuseio", "Furtividade"]
        };

        $(document).ready(function () {
            // Criar grupos dinamicamente
            $.each(grupos, function (titulo, pericias) {
                const rowSeparation = $('<div class="row"></div>');
                const section = $('<div class="col-md-6"></div>');
                section.append(`
                    <div class="d-flex justify-content-between mt-3 mb-3">
                        <h4>${titulo}</h4>
                        <button type="button" class="btn btn-outline-primary btn-sm btn-atributo-roll" data-grupo="${titulo}">üé≤ Rolar Atributo</button>
                    </div>
                `);
                const row = $('<div class="row"></div>');
                const primaryColumn = $('<div class="col-md-12"></div>');

                pericias.forEach(pericia => {
                    let checkboxes = "";
                    for (let i = 1; i <= 3; i++) {
                        checkboxes += `
                            <label>
                                <input type="checkbox" class="nivel" data-pericia="${pericia}" value="${i}"> ${i}
                            </label>`;
                        }

                        const col = $(`
                            <div class="row">
                                <div class="col-md-12 mb-2">
                                    <div class="card p-2 d-flex justify-content-between flex-row">
                                        <div>
                                            <strong>${pericia}</strong>
                                            <div class="nivel-box">${checkboxes}</div>
                                        </div>
                                        <div>
                                            <button type="button" class="btn btn-outline-secondary btn-sm btn-pericia-roll" data-pericia="${pericia}" data-grupo="${titulo}">Rolar Per√≠cia</button>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        `);
                    primaryColumn.append(col);
                });

                row.append(primaryColumn);
                section.append(row);
                rowSeparation.append(section);
                $('#grupos').append(rowSeparation);
            });

            // Controle de n√≠veis
            $(document).on('change', '.nivel', function () {
                const pericia = $(this).data('pericia');
                const nivel = parseInt($(this).val());
                const isChecked = $(this).is(':checked');

                // Marcar n√≠veis inferiores automaticamente
                $(`.nivel[data-pericia="${pericia}"]`).each(function () {
                    const val = parseInt($(this).val());
                    $(this).prop('checked', isChecked && val <= nivel);
                });
            });

            $('#fichaForm').on('submit', function (e) {
                e.preventDefault();
                let output = `<h3>${$('#nome').val()}</h3>`;

                $.each(grupos, function (titulo, pericias) {
                    let bonusPrimario = 0;
                    let bonusSecundario = 0;
                    let dadosBonus = 0;
                    output += `<h5>${titulo}</h5><ul class="list-group mb-3">`;

                    pericias.forEach(pericia => {
                        const nivel = $(`.nivel[data-pericia="${pericia}"]:checked`).length;
                        let bonusTxt = "";

                        if (nivel >= 1) bonusPrimario = 1;
                        if (nivel === 3){
                            bonusSecundario = 1;
                            bonusTxt = " (+1 dado extra)";
                        } 

                        output += `<li class="list-group-item d-flex justify-content-between">
                        <span>${pericia}</span><strong>N√≠vel ${nivel}${bonusTxt}</strong>
                        </li>`;
                    });

                    dadosBonus = bonusPrimario + bonusSecundario;

                    output += `</ul><p><strong>B√¥nus total de dados (${titulo}): +${dadosBonus}</strong></p>`;
                });

                $('#resultado').html(output);
            });

            function rolarDados(qtd) {
                let resultados = [];
                for (let i = 0; i < qtd; i++) {
                    resultados.push(Math.floor(Math.random() * 10) + 1); // d6
                }
                return resultados;
            }

            $(document).on('click', '.btn-atributo-roll', function () {
                const grupo = $(this).data('grupo');
                let bonusPrimario = 0;
                let bonusSecundario = 0;
                let dados = 0;

                // Conta b√¥nus por per√≠cias dentro do atributo
                grupos[grupo].forEach(pericia => {
                    const nivel = $(`.nivel[data-pericia="${pericia}"]:checked`).length;
                    if (nivel >= 1) bonusPrimario = 1;
                    if (nivel >= 2) bonusSecundario = 1;
                });

                dados = bonusPrimario + bonusSecundario;

                const resultados = rolarDados(dados);
                alert(`üé≤ Rolagem de Atributo (${grupo})\nDados: ${dados}d6 ‚Üí [${resultados.join(', ')}]`);
            });

            $(document).on('click', '.btn-pericia-roll', function () {
                const grupo = $(this).data('grupo');
                const pericia = $(this).data('pericia');
                let bonusPrimario = 0;
                let bonusSecundario = 0;
                let dados = 0;

                // B√¥nus do atributo
                grupos[grupo].forEach(p => {
                    const nivel = $(`.nivel[data-pericia="${p}"]:checked`).length;
                    if (nivel >= 1) bonusPrimario = 1;
                    if (nivel >= 2) bonusSecundario = 1;
                });

                dados = bonusPrimario + bonusSecundario;

                // B√¥nus da per√≠cia se mestre
                const nivelPericia = $(`.nivel[data-pericia="${pericia}"]:checked`).length;
                if (nivelPericia === 3) dados += 1;

                const resultados = rolarDados(dados);
                alert(`üéØ Rolagem de Per√≠cia (${pericia})\nDados: ${dados}d6 ‚Üí [${resultados.join(', ')}]`);
            });

        });
    </script>

</body>

</html>